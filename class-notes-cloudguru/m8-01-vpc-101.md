### VPC 101 ###
- 1 Subnet is 1 Availability Zone
- AWS Subnet Classes:
    - 10.0.0.0 - 10.255.255.255 (10/8 prefix)               Subnet mask: 255.0.0.0
    - 172.16.0.0 - 172.31.255.255 (172.16/12 prefix)        Subnet mask: 255.240.0.0
    - 192.168.0.0 - 192.168.255.255 (192.168/16 prefix)     Subnet mask: 255.255.0.0

- Once you create a new VPC, you get these created automatically:
    - XX

**What you can do with a VPC**
- You can launch an instance into a subnet of your choosing.
- Assign custom IP address ranges in each subnet.
- Configure route tables between subnets.
- Create internet gateway and attach it to your VPC.
    - You can have only one internet gateway per VPC
- Create a Security group
    - Security Group can span multiple AZ
- Subnet network access control list (ACLS)

**Default VPC vs Custom VPC**
- All subnets in default VPC have a route out to the internet.
- All EC2 instances inside default VPC gets private and public IP address. EC2 inside custom VPC gets private IP address by default.

**VPC Peering**
- You can peer VPCs via direct network route using private IP addresses.
    - VPCs from different subnets can connect to each other as well using private ip addresses.
    - VPCs from different accounts also can connect using private ip addresses.
- VPC peering connections has to be direct.
    - A -> B -> C doesn't give access from A -> C
    - you have to peer A -> C separately.

**Tips**
- 1 Subnet = 1 AZ
- Security Groups are Stateful:
    - If you open port 80 of your security group, you'll be able to send and receive through.
- Network Access Control Lists are Stateless
    - If you open port 80 for inbound only, you won't be able to send traffic through port 80. you have to add outbound rule explicitly.


### VPC Lab 1 ###
**Create your own VPC**
- *Create VPC*
    - Provide IPv4 CIDR: 10.0.0.0/16 (max host ip range)

* As soon as you create your own VPC, these are created automatically:
    - 1 Route Table
    - 1 Network Access Control List (NACL)
    - 1 Security Group (default)
    -
    - NO Subnet
    - NO Internet Gateway
    - NO NAT Gateway
* Basically it creates a new Route Table and Security stuffs (NACL, Security Group)

![Newly created VPC](/img/newvpc.png)

- *Create a new Subnet*
    - Provide IPv4 CIDR block: Less or equal to your VPC's IPv4 CIDR. e.g. 10.0.1.0/24
    * First 4 and the last IP addresses of your subnet are reserved:
        - 10.0.0.0: Network address.
        - 10.0.0.1: VPC Router.
        - 10.0.0.2: DNS Server.
        - 10.0.0.3: Future use.
        - 10.0.0.255: Broadcast address. Even though AWS doesn't support broadcasting.
- Create 2nd Subnet
    - 10.0.2.0/24

![VPC with 2 Subnets](/img/newvpc2.png)

- *Create an Internet Gateway*
    - Once created you have to attach it with your VPC.
    * You can't attach multiple Internet Gateways with 1 VPC.
    * You can't attach 1 Internet Gateway with multiple VPC.

- *Create a new Route Table*
* Default Route Table (created when you create a new VPC):
    - (Routes) By default its enables all our subnets to communicate to each other internally (Not to the internet).
    - (Subnet Associations) By default all our newly created Subnets are associated with the "main route table". And we don't want to have Internet connection to our main route table. Because then any new Subnet will be connected to internet, since all newly created subnets are by default associated with the main route table.
* So lets create a new Route Table and attach IGW with that. then associate those subnets to that route who needs to be connected to the internet.
    - Add Route and select the Internet Gateway as the target.
    - Now, every subnet that are associated with this route will have internet access.
    - For now, I'm going to associate 10.0.1.0 subnet with this new route with internet. and keep 10.1.2.0 subnet as private subnet.

*Before experimenting that scenario, we need to Enable "auto-assign IP address" to our public subnet.*

- *Let's create one EC2 instance in our public subnet and one EC2 instance in our private subnet and check which one has internet*
* Create 2 EC2 instances in two different subnets (10.0.1.0 and 10.0.2.0)

* Security Group don't span over VPC. So while creating our EC2 instances you won't find your other security groups that you used before outside of this new VPC. *You have to create a new security group for every VPC that you create*.
* Chose the newly created security group for the public EC2 instance, and the default security group for the private EC2 instancee (since the private instance wont be accessible from internet)
* You can use the old KeyPair though.

![Newly created VPC](/img/newvpc3.png)


**Even if you select the security group which have ssh & http access, and even if you allow assigning public ip address during EC2 instance creation, you won't be able to access the private instance via ssh, because the subnet the instance belongs to does not have Internet Gateway connection.**


**At this moment our two instances can't communicate to each other because haven't enabled that yet.**
